<span ng-controller="PerfController">
<style>
  .perf-chart-wrapper{
    display:inline-block;
  }

  .perf-chart {
    margin-top:5px;
    display:inline-block;
  }

  .perf-table{
    border: 1px solid #ccc;
  }

  .perf-table th {
    text-align:center;
    padding-left:10px;
    padding-right:10px;
  }
  .perf-table td {
    padding: 3px;
    text-align:right;
    border: 1px solid #888;
  }
  .perf-table tr.odd{
    background-color: #eee;
  }
  .perf-trendchart svg{
    padding-left:60px;
    padding-top:10px;
  }
  .bar-highlighted {
    color: green;
  }

  .domain{
    fill: none; 
    stroke: black; 
    stroke-width: 1; 
  }
  .comparison-table-header{
    font-weight:bold;
    text-align:right;
    padding-right:10px;
    margin-right:10px;
  }
  .chart-testname{
    font-size:.8em;
  }
  .sample-cell {
    font-size:.7em;
  }
  .compare-input{
    padding:15px;
  }
</style>
<div class="panel" ng-if="conf.enabled && task.status == 'success' && !!sample">
  <div class="panel-heading"><h4>Mongo-Perv</h4><a href="/plugin/json/task/[[task.id]]/">Download raw data (JSON)</a></div>
  <div class="panel-body">

    <ul class="nav nav-tabs">
      <li ng-class="{active:perftab==0}"><a href="#" ng-click="perftab=0">Graph</a></li>
      <li ng-class="{active:perftab==1}"><a href="#" ng-click="perftab=1">Table</a></li>
      <li ng-class="{active:perftab==2}"><a href="#" ng-click="perftab=2">Trend</a></li>
      <li ng-class="{active:perftab==3}"><a href="#" ng-click="perftab=3">Trend Table</a></li>
    </ul>
    <div class="compare-input">Compare to commit: <input type="text" placeholder="githash" ng-model="compareHash"><button ng-click="updateComparison(compareHash)" class="btn btn-primary btn-small">Update</button></div>
    <div ng-show="perftab==0">
      <div class="perf-chart-wrapper col-lg-3" ng-repeat="test in sample.data.results">
        <span class="chart-testname">[[test.name]]</span>
          <div id="y_axis-{{$index}}" class="y-axis"></div>
          <div class="perf-chart" id="chart-[[task.id]]-[[$index]]"></div>
      </div>
    </div>
    <div ng-show="perftab==1">
      <table class="perf-table">
        <tr>
          <th>Test</th>
          <th ng-repeat="k in getThreadKeys(sample.data.results)">[[k]]</th>
          <th>Max</th>
          <th ng-show="!!compareSample">max @[[compareSample.revision | limitTo:5]]</th>
          <th ng-show="!!compareSample">vs. [[compareSample.revision | limitTo:5]]</th>
        </tr>
        <tr ng-repeat="test in sample.data.results" ng-class="{odd:$odd}">
          <td>[[test.name]]</td>
          <td ng-repeat="k in getThreadKeys(sample.data.results)">[[test.results[k].ops_per_sec | number:0]]</td>
          <td>[[getMax(test.results) | number:0]]</td>
          <td ng-show="!!compareSample">[[getSampleComparison(test.name) | number:0]]</td>
          <td ng-show="!!compareSample">[[100*((getSampleComparison(test.name)-getMax(test.results))/getSampleComparison(test.name)) | number:2]]%</td>
        </tr>
      </table>
    </div>
    <div ng-show="perftab==2">
      <div class="perf-trendchart-wrapper" ng-repeat="k in testSeriesKeys">
        <span class="chart-testname">[[k]]</span>
        <div class="perf-trendchart" id="perf-trendchart-[[task.id]]-[[$index]]">
        </div>
      </div>
      <div ng-show="currentSample != null">
        <table>
          <tr><td class="comparison-table-header">Task:</td><td>[[currentSample.task_id]]</td></tr>
          <tr><td class="comparison-table-header">Ops per sec (max):</td><td>[[currentSample.ops_per_sec]]</td></tr>
          <tr><td class="comparison-table-header">vs. this task:</td><td>[[getCompareDescription(currentSample, sample)]]</td></tr>
        </table>
      </div>
    </div>
    <div ng-show="perftab==3" style="overflow-x:scroll">
      <table class="perf-table">
        <tr>
          <th>Test</th>
          <td ng-repeat="c in getCommits(testSeriesByName)">
            [[c | limitTo:4 ]]
          </td>
        </tr>
        <tr ng-repeat="k in testSeriesKeys">
          <td>[[k]]</td>
          <td ng-repeat="c in getCommits(testSeriesByName)" class="sample-cell" ng-show="!compareSample">[[getSampleAtCommit(testSeriesByName[k], c).ops_per_sec | number:0]]</td>
          <td ng-repeat="c in getCommits(testSeriesByName)" class="sample-cell" ng-show="!!compareSample" ng-style="{backgroundColor:percentToColor(getPctDiff(getSampleAtCommit(testSeriesByName[k], c).ops_per_sec, compareSample, k))}">
            [[getPctDiff(getSampleAtCommit(testSeriesByName[k], c).ops_per_sec, compareSample, k) | number:1]]%
          </td>
        </tr>
      </table>
    </div>
  </div>
</div>
</span>
